<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Prestsbakki Weather Dashboard</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body{margin:0;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fafafa}
    .wx{max-width:1100px;margin:auto;padding:16px;color:#111}
    h1{margin:0 0 6px;font-size:20px}
    .sub{font-size:12px;color:#666;margin:0 0 14px}
    .tabs{display:flex;gap:8px;margin:8px 0 14px;flex-wrap:wrap}
    .tab{padding:8px 12px;border:1px solid #ddd;border-radius:999px;cursor:pointer;font-size:12px}
    input[type=radio]{display:none}
    .page{display:none}
    #p1:checked ~ .pages #pg1,#p2:checked ~ .pages #pg2,#p3:checked ~ .pages #pg3,#p4:checked ~ .pages #pg4,#p5:checked ~ .pages #pg5{display:block}
    #p1:checked ~ .tabs label[for=p1],#p2:checked ~ .tabs label[for=p2],#p3:checked ~ .tabs label[for=p3],#p4:checked ~ .tabs label[for=p4],#p5:checked ~ .tabs label[for=p5]{background:#eee}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
    @media (max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    .card{background:#fff;border:1px solid #ddd;border-radius:14px;padding:12px}
    .k{font-size:12px;color:#666;margin-bottom:6px}
    .v{font-size:22px;font-weight:700}
    .note{font-size:11px;color:#666;margin-top:6px}
    .pill{padding:4px 8px;border-radius:999px;font-size:11px;border:1px solid #ddd;margin:2px}
    .ok{background:#e6fbe6;border-color:#cceccc}
    .warn{background:#fff7e0;border-color:#ffecb3}
    .bad{background:#fde2e1;border-color:#fbb}
  </style>
</head>
<body>
<div class="wx">
  <h1>Weathercloud Prestsbakki ‚Äî Dashboard</h1>
  <div class="sub" id="timestamp">Hle√∞ g√∂gnum...</div>

  <input type="radio" id="p1" name="tab" checked>
  <input type="radio" id="p2" name="tab">
  <input type="radio" id="p3" name="tab">
  <input type="radio" id="p4" name="tab">
  <input type="radio" id="p5" name="tab">

  <div class="tabs">
    <label class="tab" for="p1">Yfirlit</label>
    <label class="tab" for="p2">Vindur</label>
    <label class="tab" for="p3">Hiti &amp; Raki</label>
    <label class="tab" for="p4">Inni</label>
    <label class="tab" for="p5">A√∞varanir</label>
  </div>

  <div class="pages">
    <div id="pg1" class="page"><div class="grid" id="overview"></div></div>
    <div id="pg2" class="page"><div class="grid" id="wind"></div></div>
    <div id="pg3" class="page"><div class="grid" id="temp"></div></div>
    <div id="pg4" class="page"><div class="grid" id="inside"></div></div>
    <div id="pg5" class="page"><div id="alerts"></div></div>
  </div>
</div>

<script>
  // üîó √ûinn Google Sheets CSV linkur
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRUcwYyuBJGhs-FjH19RdCEeGw_KNulQvK1VOXjDIPHaVDFmJ4lom0b6IIbvPIhCe6uV9qREXqGAkJE/pub?output=csv";

  async function loadData(){
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const rows = text.trim().split("\n").map(r=>r.split(","));
    const headers = rows[0];
    const values = rows[1];
    const d = {};
    headers.forEach((h,i)=> d[h.trim()] = parseFloat(values[i]) || values[i]);
    return d;
  }

  function card(k,v,note=""){ return `<div class="card"><div class="k">${k}</div><div class="v">${v}</div>${note?`<div class="note">${note}</div>`:""}</div>`; }

  function render(d){
    document.getElementById("timestamp").textContent = "S√≠√∞ast uppf√¶rt: " + d.timestamp;
    document.getElementById("overview").innerHTML =
      card("Vindhra√∞i (n√∫)", d.windNow+" m/s", "Me√∞alvindur "+d.windAvg+" m/s") +
      card("Hvi√∞ur (mest)", d.gustMax+" m/s") +
      card("Hitastig (n√∫)", d.tempNow+" ¬∞C", "L√°g/H√° "+d.tMin+" / "+d.tMax) +
      card("Vindk√¶ling", d.chillNow+" ¬∞C") +
      card("Daggarmark", d.dewNow+" ¬∞C") +
      card("Hitav√≠sir", d.heatIndex+" ¬∞C") +
      card("Rakastig", d.humNow+" %") +
      card("Innihiti", d.inTemp+" ¬∞C");

    document.getElementById("wind").innerHTML =
      card("Me√∞alvindur", d.windAvg+" m/s") +
      card("Vindhra√∞i (n√∫)", d.windNow+" m/s") +
      card("Hvi√∞ur (n√∫)", d.gustNow+" m/s") +
      card("Hvi√∞ur (mest)", d.gustMax+" m/s");

    document.getElementById("temp").innerHTML =
      card("Hitastig (n√∫)", d.tempNow+" ¬∞C", "L√°g/H√° "+d.tMin+" / "+d.tMax) +
      card("Vindk√¶ling", d.chillNow+" ¬∞C") +
      card("Daggarmark", d.dewNow+" ¬∞C") +
      card("Hitav√≠sir", d.heatIndex+" ¬∞C") +
      card("Rakastig", d.humNow+" %");

    document.getElementById("inside").innerHTML =
      card("Innihiti", d.inTemp+" ¬∞C") +
      card("Innirkaki", d.inHum+" %");

    const alerts = [];
    if (d.gustNow >= 20) alerts.push(`<div class="pill bad">H√°ar hvi√∞ur ‚â•20 m/s</div>`);
    if (d.chillNow <= -5) alerts.push(`<div class="pill warn">Vindk√¶ling ‚â§-5 ¬∞C</div>`);
    if (d.heatIndex >= 27) alerts.push(`<div class="pill warn">Hitav√≠sir ‚â•27 ¬∞C</div>`);
    document.getElementById("alerts").innerHTML = alerts.join(" ") || "<div class='pill ok'>Engar a√∞varanir</div>";
  }

  loadData().then(render).catch(e=>{
    document.getElementById("timestamp").textContent = "Villa: " + e;
  });

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js");
  }
</script>
</body>
</html>
