// Dagssíða – aðeins ef dagur valinn
    const dayWrap=document.getElementById("dayWrap");
    if(document.getElementById("daySel").value){
      const selectedDate = document.getElementById("daySel").value;
      const D = filterRange(ALL,null,null,selectedDate);
      if(!D.length){ dayWrap.className="empty"; dayWrap.textContent="Engin gögn fyrir þennan dag."; }
      else{
        // Hourly data only
        const hourlyData = [];
        for(let h = 0; h < 24; h++) {
          const hourRecords = D.filter(r => r.ts.getHours() === h);
          if(hourRecords.length) {
            hourlyData.push(hourRecords[0]); // Take first record of each hour
          }
        }
        
        const tiles = hourlyData.map(r=>{
          const cond = inferCondPoint(r.temp, r.wind, r.rainRate, r.solar);
          return `<div class="tile">
            <div class="time">${fmtTime(r.ts)}</div>
            <div class="icowrap">${ICONS[cond]}</div>
            <div class="muted">Hiti ${fmt(r.temp)}°C • Vindur ${fmt(r.wind)} m/s • Raki ${fmt(r.hum,0)}% • Þrýstingur ${fmt(r.press,1)} hPa</div>
          </div>`;
        }).join("");
        
        // Get last year's data for comparison
        const selDate = new Date(selectedDate);
        const lastYearDate = new Date(selDate);
        lastYearDate.setFullYear(selDate.getFullYear() - 1);
        const lastYearISO = lastYearDate.toISOString().slice(0,10);
        const lastYearData = filterRange(ALL, null, null, lastYearISO);
        
        // Line charts for the day
        const daySeries = k => D.filter(r => r[k] != null).map(r => ({x: +r.ts, y: r[k]}));
        const dayCharts = `
          <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-top:16px">
            <div class="card chart"><div class="k">Hiti yfir daginn</div><canvas id="cDayTemp"></canvas></div>
            <div class="card chart"><div class="k">Vindur yfir daginn</div><canvas id="cDayWind"></canvas></div>
          </div>
        `;
        
        dayWrap.className="";
        dayWrap.innerHTML = analyzeDayWeather(D, lastYearData) + dayCharts + `<div class="timeline" style="margin-top:16px">${tiles}</div>`;
        
        // Draw day charts
        setTimeout(() => {
          const cDayTemp = document.getElementById("cDayTemp");
          const cDayWind = document.getElementById("cDayWind");
          if(cDayTemp) drawSeries(cDayTemp, daySeries("temp"), "°C");
          if(cDayWind) drawSeries(cDayWind, daySeries("wind"), "m/s");
        }, 100);
      }
    } else {
      dayWrap.className="empty";
      dayWrap.textContent="Veldu dag hér að ofan til að sjá tímalínu með táknum.";
    }
    
    // Mánaðarsamanburður
    const monthWrap = document.getElementById("monthWrap");
    const selectedYear = parseInt(document.getElementById("yearSel").value || "", 10);
    if(selectedYear) {
      const months = ["Janúar", "Febrúar", "Mars", "Apríl", "Maí", "Júní", "Júlí", "Ágúst", "September", "Október", "Nóvember", "Desember"];
      let monthCards = "";
      
      for(let m = 1; m <= 12; m++) {
        const monthData = filterRange(ALL, selectedYear, m, null);
        if(monthData.length) {
          const temps = monthData.map(r => r.temp).filter(v => v != null);
          const winds = monthData.map(r => r.wind).filter(v => v != null);
          const rain = monthData.map(r => r.rain).filter(v => v != null);
          const totalRain = rain.length ? rain.reduce((a,b) => a+b, 0) : null;
          
          monthCards += `
            <div class="month-card">
              <h4>${months[m-1]}</h4>
              <div class="month-stats">
                <div><span class="label">Meðalhiti:</span> <span class="value">${fmt(mean(temps))}°C</span></div>
                <div><span class="label">Lágmark:</span> <span class="value">${fmt(minA(temps))}°C</span></div>
                <div><span class="label">Hámark:</span> <span class="value">${fmt(maxA(temps))}°C</span></div>
                <div><span class="label">Meðalvindur:</span> <span class="value">${fmt(mean(winds))} m/s</span></div>
                <div><span class="label">Úrkoma:</span> <span class="value">${fmt(totalRain,1)} mm</span></div>
              </div>
            </div>
          `;
        }
      }
      
      monthWrap.className = "month-grid";
      monthWrap.innerHTML = monthCards || '<div class="empty">Engin gögn fyrir þetta ár.</div>';
    } else {
      monthWrap.className = "empty";
      monthWrap.textContent = "Veldu ár hér að ofan til að sjá mánaðarsamanburð.";
    }
    
    // Mælaborð (Gauges)
    const gaugeWrap = document.getElementById("gaugeWrap");
    const latestData = base[base.length - 1] || {};
    
    gaugeWrap.innerHTML = `
      ${createGauge(fmt(latestData.temp, 1), -10, 30, "°C", "Hitastig")}
      ${createGauge(fmt(latestData.hum, 0), 0, 100, "%", "Rakastig")}
      ${createGauge(fmt(latestData.press, 1), 950, 1050, " hPa", "Loftþrýstingur")}
      
      <div class="card">
        <div class="k">Hitastig</div>
        <div class="v">${fmt(latestData.temp)} °C</div>
        <table class="minmax-table">
          <tr><td>Dagur</td><td class="max-val">${fmt(maxA(base.map(x=>x.temp)))}°C</td><td class="min-val">${fmt(minA(base.map(x=>x.temp)))}°C</td></tr>
          <tr><td>Mánuður</td><td class="max-val">${fmt(maxA(base.map(x=>x.temp)))}°C</td><td class="min-val">${fmt(minA(base.map(x=>x.temp)))}°C</td></tr>
          <tr><td>Allt</td><td class="max-val">${fmt(maxA(tAll))}°C</td><td class="min-val">${fmt(minA(tAll))}°C</td></tr>
        </table>
      </div>
      
      <div class="card">
        <div class="k">Rakastig</div>
        <div class="v">${fmt(latestData.hum, 0)} %</div>
        <table class="minmax-table">
          <tr><td>Dagur</td><td class="max-val">${fmt(maxA(base.map(x=>x.hum)),0)}%</td><td class="min-val">${fmt(minA(base.map(x=>x.hum)),0)}%</td></tr>
          <tr><td>Mánuður</td><td class="max-val">${fmt(maxA(base.map(x=>x.hum)),0)}%</td><td class="min-val">${fmt(minA(base.map(x=>x.hum)),0)}%</td></tr>
          <tr><td>Allt</td><td class="max-val">${fmt(maxA(hAll),0)}%</td><td class="min-val">${fmt(minA(hAll),0)}%</td></tr>
        </table>
      </div>
      
      <div class="card">
        <div class="k">Loftþrýstingur</div>
        <div class="v">${fmt(latestData.press, 1)} hPa</div>
        <table class="minmax-table">
          <tr><td>Dagur</td><td class="max-val">${fmt(maxA(base.map(x=>x.press)),1)} hPa</td><td class="min-val">${fmt(minA(base.map(x=>x.press)),1)} hPa</td></tr>
          <tr><td>Mánuður</td><td class="max-val">${fmt(maxA(base.map(x=>x.press)),1)} hPa</td><td class="min-val">${fmt(minA(base.map(x=>x.press)),1)} hPa</td></tr>
          <tr><td>Allt</td><td class="max-val">${fmt(maxA(pAll),1)} hPa</td><td class="min-val">${fmt(minA(pAll),1)} hPa</td></tr>
        </table>
      </div>
    `
      <input type="radio" id="p1" name="tab" checked>
  <input type="radio" id="p2" name="tab">
  <input type="radio" id="p3" name="tab">
  <input type="radio" id="p4" name="tab">
  <input type="radio" id="p5" name="tab">
  <input type="radio" id="p6" name="tab">
  <input type="radio" id="p7" name="tab">
  <input type="radio" id="p8" name="tab">

  <div class="tabs">
    <label class="tab" for="p1">Yfirlit</label>
    <label class="tab" for="p2">Vindur</label>
    <label class="tab" for="p3">Hiti &amp; Raki</label>
    <label class="tab" for="p4">Aðrar mælingar</label>
    <label class="tab" for="p5">Línurit</label>
    <label class="tab" for="p6">Dagur</label>
    <label class="tab" for="p7">Mánaðir</label>
    <label class="tab" for="p8">Mælaborð</label>
  </div>
